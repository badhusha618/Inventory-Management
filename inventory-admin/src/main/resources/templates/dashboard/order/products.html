<!DOCTYPE html>
<!--/*
  ~
  ~    Copyright (c) 2017 Makinus Pvt Ltd - All Rights Reserved
  ~
  ~    Unauthorized copying of this file, via any medium is strictly prohibited
  ~    Proprietary and confidential
  ~    Written by Makinus Pvt Ltd
  ~
  */-->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{dashboard/dashboard-layout}" th:with="orderManagementModule='active',productsListModule='active' ">

<head>
    <title>Products List</title>
    <!-- GLOBAL MAINLY STYLES-->
    <link href="/resources/css/bootstrap.min.css" th:href="@{/resources/css/bootstrap.min.css}" rel="stylesheet" media="screen" />
    <link href="/resources/css/font-awesome.min.css" th:href="@{/resources/css/font-awesome.min.css}" rel="stylesheet"
          media="screen" />
    <link href="/resources/css/themify-icons.css" th:href="@{/resources/css/themify-icons.css}" rel="stylesheet" media="screen" />
    <!-- THEME STYLES-->
    <link href="/resources/css/main.css" th:href="@{/resources/css/main.css}" rel="stylesheet" />
    <!-- PAGE LEVEL STYLES-->
    <!--/*  Bootstrap Lightbox CSS   */-->
    <link href="/resources/css/ekko-lightbox.css" th:href="@{/resources/css/ekko-lightbox.css}" rel="stylesheet" media="screen"/>
    <!-- PLUGINS STYLES-->
    <link href="/resources/css/datatables.min.css" th:href="@{/resources/css/datatables.min.css}" rel="stylesheet"
          media="screen" />
    <link href="/resources/css/sweetalert2.min.css" th:href="@{/resources/css/sweetalert2.min.css}" rel="stylesheet"
          media="screen" />
    <link href="/resources/css/bootstrap-datepicker3.min.css" th:href="@{/resources/css/bootstrap-datepicker3.min.css}" rel="stylesheet"
          media="screen" />
</head>

<body>

<th:block layout:fragment="header">
    <div th:replace="~{dashboard/header :: header}"></div>
</th:block>

<th:block layout:fragment="sidebar">
    <div th:replace="~{dashboard/sidebar :: sidebar}"></div>
</th:block>

<th:block layout:fragment="content">
    <!-- START PAGE CONTENT-->
    <div class="page-heading">
        <h1 class="page-title">Ordered Products</h1>
    </div>
    <div class="page-content fade-in-up">
        <div class="ibox">
            <div class="ibox-head">
                <div class="ibox-title">Ordered - Products&nbsp;(<span th:text="${#lists.size(productOrderList)}"></span>)</div>
                <div>
                <a th:if="${#lists.size(productOrderList) > 0}" class="btn btn-success btn-rounded float-left" href="/export/productorders.mk" th:href="@{/export/productorders.mk}"><i class="fa fa-upload"></i>&nbsp; Export</a>&nbsp;&nbsp;
                </div>
            </div>
            <div class="ibox-body">
                <form id="productOrderFilterForm" th:action="@{/order/products/search.mk}" th:object="${productOrderFilterForm}" method="post">
                    <fieldset th:with="isCollabsile = ${fromSearch == 'true' ? '' : 'collapsed-mode'}, isDisplayable = ${fromSearch == 'true' ? '' : 'display:none;'}">
                        <div th:class="'ibox '+ ${isCollabsile}" style="background-color: rgb(226, 242, 247)">
                            <div class="ibox-head">
                                <div class="ibox-title">Product Filter</div>
                                <div class="ibox-tools">
                                    <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                </div>
                            </div>
                            <div class="ibox-body" th:style="${isDisplayable}">
                                <div class="col-sm-12">
                                    <div class="row">
                                        <div class="col-sm-3 form-group">
                                            <label for="fromDateInput">From Date </label>
                                            <div class="input-group date currentdatepicker">
                                                <span class="input-group-addon bg-white"><i class="fa fa-calendar"></i></span>
                                                <input class="form-control" type="text" id="fromDateInput" th:field="*{fromOrderDate}" placeholder="dd/mm/yyyy" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-sm-3 form-group">
                                            <label for="toDateInput">To Date</label>
                                            <div class="input-group date currentdatepicker">
                                                <span class="input-group-addon bg-white"><i class="fa fa-calendar"></i></span>
                                                <input class="form-control" type="text" id="toDateInput" th:field="*{toOrderDate}" placeholder="dd/mm/yyyy" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-sm-3 form-group">
                                            <label>Status</label>
                                            <select class="form-control" id="statusInput" th:field="*{status}">
                                                <option value="">Select</option>
                                                <th:block th:each="productOrderStatus: ${T(com.makinus.unitedsupplies.common.data.reftype.ProdOrderStatus).values()}">
                                                    <option th:value="${productOrderStatus.status}" th:text="${productOrderStatus.display}"></option>
                                                </th:block>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-3 form-group">
                                            <label>Product Name</label>
                                            <input class="form-control" type="text" id="productNameInput" th:field="*{productName}" maxlength="50">
                                        </div>
                                        <div class="col-sm-3 form-group">
                                            <label>Product Code</label>
                                            <input class="form-control" type="text" id="productCodeInput" th:field="*{productCode}" maxlength="50">
                                        </div>
                                        <div class="col-sm-3 form-group">
                                            <label>Vendor Code</label>
                                            <input class="form-control" type="text" id="vendorCodeInput" th:field="*{vendorCode}" maxlength="50">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group text-right">
                                    <button class="btn btn-danger reset-btn" type="reset">Reset</button>
                                    <button class="btn btn-success" type="submit">Search</button>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
                <hr th:if="${productOrderFilterForm}"/>
                <table class="table table-striped table-bordered table-hover" id="productOrdersTable" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>Order No</th>
                        <th>Order Date</th>
                        <th>Product Details</th>
                        <th>Quantity</th>
                        <th>Vendor</th>
                        <th>Status</th>
                        <th>Total Amount(Rs)</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="productOrder : ${productOrderList}">
                        <td>
                            <span th:text="${orderListMap.get(productOrder.orderRef).orderNo + ' - ' + fulfillmentMap.get(productOrder.fulfillmentId).fulfillmentRef}" >Order No</span><br>
                            <span th:text="${'REF'+orderListMap.get(productOrder.orderRef).orderRef }" >Order No</span>
                        </td>
                        <td>
                            <span th:text="${T(com.makinus.unitedsupplies.common.utils.AppUtils).getLocalTimezoneDate(orderListMap.get(productOrder.orderRef).orderDate, zone)}">Order Date</span>
                        </td>
                        <td>
                            <span class="badge badge-default">Code</span> <span th:text="${T(com.makinus.unitedsupplies.common.utils.AppUtils).getProductFromMap(productMap, productOrder.productId).productCode}">Product Code</span>
                            <br/>
                            <span th:text="${T(com.makinus.unitedsupplies.common.utils.AppUtils).getProductFromMap(productMap, productOrder.productId).productName}">Product Name</span><br/>
                        </td>
                        <td>
                            <span th:text="${productOrder.proQuantity}">Quantity</span>
                        </td>
                        <td>
                            <span th:text="${T(com.makinus.unitedsupplies.common.utils.AppUtils).getVendorFromMap(vendorMap,productOrder.prodVendorId).vendorCode + ' - ' + T(com.makinus.unitedsupplies.common.utils.AppUtils).getVendorFromMap(vendorMap,productOrder.prodVendorId).vendorName}">Vendor</span>
                        </td>
                        <td>
                            <span th:text="${T(com.makinus.unitedsupplies.common.data.reftype.ProdOrderStatus).statusMatch(productOrder.Status).getDisplay()}">Status</span>
                        </td>
                        <td>
                            <span th:text="${(productOrder.proQuantity * productOrder.prodSaleRate) + productOrder.loadingCharges + productOrder.transportCharges}">Total Amount</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- END PAGE CONTENT-->
</th:block>

<th:block layout:fragment="pageplugin">
    <!-- PAGE LEVEL PLUGINS-->
    <script src="/resources/js/datatables.min.js" th:src="@{/resources/js/datatables.min.js}" type="text/javascript"></script>
    <script src="/resources/js/sweetalert2.min.js" th:src="@{/resources/js/sweetalert2.min.js}" type="text/javascript"></script>
    <!-- Sweet Alert 2 plugin -->
    <script src="/resources/js/es6-promise-auto.min.js" th:src="@{/resources/js/es6-promise-auto.min.js}" type="text/javascript"></script>
    <!-- Promise Library for SweetAlert2 working on IE -->
    <!-- Bootstrap Lightbox Plugin -->
    <script src="/resources/js/ekko-lightbox.min.js" th:src="@{/resources/js/ekko-lightbox.min.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7.1.0/dist/promise.min.js"></script>
    <!--  Notifications Plugin    -->
    <script src="/resources/js/bootstrap-notify.js" th:src="@{/resources/js/bootstrap-notify.js}"></script>
    <script src="/resources/js/bootstrap-datepicker3.min.js" th:src="@{/resources/js/bootstrap-datepicker.min.js}"></script>
</th:block>

<th:block layout:fragment="pagescript">
    <!-- PAGE LEVEL SCRIPTS-->
    <script type="text/javascript" th:inline="javascript">
            /*<![CDATA[*/

            $('[rel="tooltip"]').tooltip({
                trigger: 'hover'
            });

            var oTable;

            $(document).ready(function() {

                $('[rel="tooltip"]').tooltip({
                    trigger: 'hover'
                });

                oTable = $('#productOrdersTable').DataTable({
                    pageLength: 10,
                    "language": {
                        "emptyTable": "No Product Orders Found"
                    },
                    order: []
                });

                $('.reset-btn').click(function(){
                    $('#fromDateInput').removeAttr("value");
                    $('#toDateInput').removeAttr("value");
                    $('#statusInput').find("option").removeAttr("selected");
                    $('#productNameInput').removeAttr("value");
                    $('#productCodeInput').removeAttr("value");
                    $('#vendorCodeInput').removeAttr("value");
                });

                $('.currentdatepicker').datepicker({
                    todayBtn: true,
                    keyboardNavigation: false,
                    forceParse: false,
                    calendarWeeks: true,
                    autoclose: true,
                    format: "dd/mm/yyyy"
                });

            });


        </script>
</th:block>

</body>

</html>